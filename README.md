# OSSMOSS Hasher Database Application
Курсовой проект по курсу «Базы данных» на тему «Система обнаружения некорректных заимствований в исходных текстах программ» (2017 г.).

Приложение позволяет:
- хранить исходные тексты программ студентов и информацию о полученном файле
- находить тексты, имеющие схожие части
- сравнивать два файла
- выводить статистику о схожести файлов

Принцип работы системы состоит в том, чтобы разбить файл исходного кода на массив лексем, объединять k подряд идущих лексем в чанки. Для каждого чанка получать его хэш-код. Таким образом, если два файла имеют чанки с одинаковыми хэш-кодами, они имеют идентичные участи кода длины k.

База данных хранит в себе информацию о файлах (идентификатор студента, время добавления, язык программирования), агрегированных по задачам, и таблицу хэш-кодов со ссылками на файлы, в которых они встречаются. Это позволяет в пределах одной задачи быстро искать файлы, с совпадающими участками кода, находить совпадающие участки в любых двух выбранных файлах и процент их схожести.

Исходный алгоритм сравнения двух файлов описан в статье 
[Schleimer - Local Algorithms for Document Fingerprinting](http://theory.stanford.edu/~aiken/publications/papers/sigmod03.pdf).

Подробное описание алгоритма и принципов работы приложения приведено в файле «Записка_OSSMOSS_DB_2017.pdf».

Лексический и синтаксический анализ исходных текстов и получение массива хэш-кодов для каждого файла выполняется с помощью модуля `ossmoss-hasher`, предоставленного Скоробогатовым Сергеем Юрьевичем.

---

## Системные требования
Для запуска:
- PostgreSQL 9.5
- Java JRE 1.8

Для компиляции:
- Maven 3
- Java JDK 8

Компиляция (при изменении исходного кода в папке `source`):
```bash
cd source
mvn package
```
Для обновления текущего рабочего файла на скомпилированный выполнить в папке `source`:
```bash
mv target/ossmoss-hasher-database-1.0.jar ..
```

## Установка и запуск
Перед запуском скриптов необходимо убедиться, что все скрипты (.sh-файлы) являются выполняемыми. Для этого в консоли необходимо выполнить (в папке `ossmoss-hasher-database`):
```bash
chmod +x *.sh
```
Также должен быть запущен сервер postgresql. Для Gentoo-4.9.5:
```bash
sudo systemctl start postgresql-9.5
```
Выполнить следующие шаги:
1. Создание базы данных в PostgreSQL 9.5 (В дальнейшем будем считать, что имя пользователя - *testUser*, имя базы данных - *test*, имена могут быть любыми, допустимыми СУБД PostgreSQL). Выполнить в командной строке:
```bash
./create_database.sh <user> <database>
```
2. Инициализация бызы данных:
```bash
./init_database.sh <user> <database name>
```
3. Запуск приложения (должен быть запущен сервер postgresql, иначе приложение сообщит об ошибке):
```bash
./start.sh
```
или

```bash
./start.sh -f <file>.json
```
или 
```bash
./start.sh -d <database URL> -u <user>
```

**ВНИМАНИЕ! Имя базы данных (`<database name>`) и URL базы данных (`<database URL>`) не одно и то же! Например, для локальной базы данных с именем `test`, URL будет иметь вид `jdbc:postgresql://localhost/test`.**

В любом случае будет открыто окно, где можно будет ввести URL базы данных и имя пользователя для подключения. В случае, если указаны аргументы командной строки, в открывшемся окне эти поля уже будут заполнены.
После имени архива и ключа `-f` аргументом идет файл с настройками - именем пользователя и базой данных для подключения. Имя файла может быть любым. Файл должен иметь структуру приведенного файла `saved_properties.json`, который будет открыт по умолчанию в случае, если аргументы не указаны. В этот же файл будут сохранены параметры последней базы данных, к которой производилось подключение.

Пароль к базе данных не хранится, и в случае, если он установлен, его необходимо будет вводить в появившемся окне.

**ВНИМАНИЕ! Приложение позволяет добавлять только файлы исходного кода. Добавление задач должно производиться отдельно (см. скрипт test-data/ADD_TEST_PROBLEM_TO_DB.sql)**

Информацию о файлах, хранящуюся в базе данных, можно посмотреть во вкладке `Database main info`. Если щелкнуть на строку с парой файлов, откроется окно сравнения исходных текстов этих файлов, где цветом выделены идентичные участки кода.

## Запуск тестового примера

1. Выполнить шаги 1 и 2 из пункта **Запуск**.
2. Выполнить в командной строке:
```bash
./init_test_db.sh <user> <database>
```
Этот скрипт добавляет в базу данных задачи с номерами 11 и 95.
3. Запустить приложение (шаг 3 пункта **Запуск**).
4. Подключиться к базе данных (нажать кнопку `Connect`)
5. Загрузить в базу данных тестовые примеры из папки test-data.

Ввести данные о задаче 11 - адрес папки, номер и версию задачи:
- `Source directory`: test-data/011 Подсчёт слов в строке
- `Task number`: 11 
- `Task version`: 1 

Добавить эти файлы (Кнопка `Add files`).

Добавить вторую задачу:
- `Source directory`: test-data/095 Кратчайшая суперстрока
- `Task number`: 95 
- `Task version`: 1 

Добавить эти файлы.

Теперь во вкладке `Database main info` доступна информация о присланных решениях задач 11 и 95 версии 1.
